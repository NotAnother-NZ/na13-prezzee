const countryCodes = [
    "AF",
    "AL",
    "DZ",
    "AD",
    "AO",
    "AG",
    "AR",
    "AM",
    "AU",
    "AT",
    "AZ",
    "BS",
    "BH",
    "BD",
    "BB",
    "BY",
    "BE",
    "BZ",
    "BJ",
    "BT",
    "BO",
    "BA",
    "BW",
    "BR",
    "BN",
    "BG",
    "BF",
    "BI",
    "CV",
    "KH",
    "CM",
    "CA",
    "CF",
    "TD",
    "CL",
    "CN",
    "CO",
    "KM",
    "CG",
    "CD",
    "CR",
    "HR",
    "CU",
    "CY",
    "CZ",
    "DK",
    "DJ",
    "DM",
    "DO",
    "TL",
    "EC",
    "EG",
    "SV",
    "GQ",
    "ER",
    "EE",
    "SZ",
    "ET",
    "FJ",
    "FI",
    "FR",
    "GA",
    "GM",
    "GE",
    "DE",
    "GH",
    "GR",
    "GD",
    "GT",
    "GN",
    "GW",
    "GY",
    "HT",
    "HN",
    "HU",
    "IS",
    "IN",
    "ID",
    "IR",
    "IQ",
    "IE",
    "IL",
    "IT",
    "JM",
    "JP",
    "JO",
    "KZ",
    "KE",
    "KI",
    "KW",
    "KG",
    "LA",
    "LV",
    "LB",
    "LS",
    "LR",
    "LY",
    "LI",
    "LT",
    "LU",
    "MG",
    "MW",
    "MY",
    "MV",
    "ML",
    "MT",
    "MH",
    "MR",
    "MU",
    "MX",
    "FM",
    "MD",
    "MC",
    "MN",
    "ME",
    "MA",
    "MZ",
    "MM",
    "NA",
    "NR",
    "NP",
    "NL",
    "NZ",
    "NI",
    "NE",
    "NG",
    "KP",
    "MK",
    "NO",
    "OM",
    "PK",
    "PW",
    "PA",
    "PG",
    "PY",
    "PE",
    "PH",
    "PL",
    "PT",
    "QA",
    "RO",
    "RU",
    "RW",
    "KN",
    "LC",
    "VC",
    "WS",
    "SM",
    "ST",
    "SA",
    "SN",
    "RS",
    "SC",
    "SL",
    "SG",
    "SK",
    "SI",
    "SB",
    "SO",
    "ZA",
    "KR",
    "SS",
    "ES",
    "LK",
    "SD",
    "SR",
    "SE",
    "CH",
    "SY",
    "TW",
    "TJ",
    "TZ",
    "TH",
    "TG",
    "TO",
    "TT",
    "TN",
    "TR",
    "TM",
    "TV",
    "UG",
    "UA",
    "AE",
    "GB",
    "US",
    "UY",
    "UZ",
    "VU",
    "VA",
    "VE",
    "VN",
    "YE",
    "ZM",
    "ZW",
  ],
  countryNames = {
    AF: "Afghanistan",
    AL: "Albania",
    DZ: "Algeria",
    AD: "Andorra",
    AO: "Angola",
    AG: "Antigua and Barbuda",
    AR: "Argentina",
    AM: "Armenia",
    AU: "Australia",
    AT: "Austria",
    AZ: "Azerbaijan",
    BS: "Bahamas",
    BH: "Bahrain",
    BD: "Bangladesh",
    BB: "Barbados",
    BY: "Belarus",
    BE: "Belgium",
    BZ: "Belize",
    BJ: "Benin",
    BT: "Bhutan",
    BO: "Bolivia",
    BA: "Bosnia and Herzegovina",
    BW: "Botswana",
    BR: "Brazil",
    BN: "Brunei",
    BG: "Bulgaria",
    BF: "Burkina Faso",
    BI: "Burundi",
    CV: "Cabo Verde",
    KH: "Cambodia",
    CM: "Cameroon",
    CA: "Canada",
    CF: "Central African Republic",
    TD: "Chad",
    CL: "Chile",
    CN: "China",
    CO: "Colombia",
    KM: "Comoros",
    CG: "Congo",
    CD: "Congo (DRC)",
    CR: "Costa Rica",
    HR: "Croatia",
    CU: "Cuba",
    CY: "Cyprus",
    CZ: "Czech Republic",
    DK: "Denmark",
    DJ: "Djibouti",
    DM: "Dominica",
    DO: "Dominican Republic",
    TL: "East Timor",
    EC: "Ecuador",
    EG: "Egypt",
    SV: "El Salvador",
    GQ: "Equatorial Guinea",
    ER: "Eritrea",
    EE: "Estonia",
    SZ: "Eswatini",
    ET: "Ethiopia",
    FJ: "Fiji",
    FI: "Finland",
    FR: "France",
    GA: "Gabon",
    GM: "Gambia",
    GE: "Georgia",
    DE: "Germany",
    GH: "Ghana",
    GR: "Greece",
    GD: "Grenada",
    GT: "Guatemala",
    GN: "Guinea",
    GW: "Guinea-Bissau",
    GY: "Guyana",
    HT: "Haiti",
    HN: "Honduras",
    HU: "Hungary",
    IS: "Iceland",
    IN: "India",
    ID: "Indonesia",
    IR: "Iran",
    IQ: "Iraq",
    IE: "Ireland",
    IL: "Israel",
    IT: "Italy",
    JM: "Jamaica",
    JP: "Japan",
    JO: "Jordan",
    KZ: "Kazakhstan",
    KE: "Kenya",
    KI: "Kiribati",
    KW: "Kuwait",
    KG: "Kyrgyzstan",
    LA: "Laos",
    LV: "Latvia",
    LB: "Lebanon",
    LS: "Lesotho",
    LR: "Liberia",
    LY: "Libya",
    LI: "Liechtenstein",
    LT: "Lithuania",
    LU: "Luxembourg",
    MG: "Madagascar",
    MW: "Malawi",
    MY: "Malaysia",
    MV: "Maldives",
    ML: "Mali",
    MT: "Malta",
    MH: "Marshall Islands",
    MR: "Mauritania",
    MU: "Mauritius",
    MX: "Mexico",
    FM: "Micronesia",
    MD: "Moldova",
    MC: "Monaco",
    MN: "Mongolia",
    ME: "Montenegro",
    MA: "Morocco",
    MZ: "Mozambique",
    MM: "Myanmar",
    NA: "Namibia",
    NR: "Nauru",
    NP: "Nepal",
    NL: "Netherlands",
    NZ: "New Zealand",
    NI: "Nicaragua",
    NE: "Niger",
    NG: "Nigeria",
    KP: "North Korea",
    MK: "North Macedonia",
    NO: "Norway",
    OM: "Oman",
    PK: "Pakistan",
    PW: "Palau",
    PA: "Panama",
    PG: "Papua New Guinea",
    PY: "Paraguay",
    PE: "Peru",
    PH: "Philippines",
    PL: "Poland",
    PT: "Portugal",
    QA: "Qatar",
    RO: "Romania",
    RU: "Russia",
    RW: "Rwanda",
    KN: "Saint Kitts and Nevis",
    LC: "Saint Lucia",
    VC: "Saint Vincent and the Grenadines",
    WS: "Samoa",
    SM: "San Marino",
    ST: "Sao Tome and Principe",
    SA: "Saudi Arabia",
    SN: "Senegal",
    RS: "Serbia",
    SC: "Seychelles",
    SL: "Sierra Leone",
    SG: "Singapore",
    SK: "Slovakia",
    SI: "Slovenia",
    SB: "Solomon Islands",
    SO: "Somalia",
    ZA: "South Africa",
    KR: "South Korea",
    SS: "South Sudan",
    ES: "Spain",
    LK: "Sri Lanka",
    SD: "Sudan",
    SR: "Suriname",
    SE: "Sweden",
    CH: "Switzerland",
    SY: "Syria",
    TW: "Taiwan",
    TJ: "Tajikistan",
    TZ: "Tanzania",
    TH: "Thailand",
    TG: "Togo",
    TO: "Tonga",
    TT: "Trinidad and Tobago",
    TN: "Tunisia",
    TR: "Turkey",
    TM: "Turkmenistan",
    TV: "Tuvalu",
    UG: "Uganda",
    UA: "Ukraine",
    AE: "United Arab Emirates",
    GB: "United Kingdom",
    US: "United States",
    UY: "Uruguay",
    UZ: "Uzbekistan",
    VU: "Vanuatu",
    VA: "Vatican City",
    VE: "Venezuela",
    VN: "Vietnam",
    YE: "Yemen",
    ZM: "Zambia",
    ZW: "Zimbabwe",
  };

// Example phone numbers for placeholders
const exampleNumbers = {
  AF: "+93 000 000 0000",
  AL: "+355 000 000 0000",
  DZ: "+213 000 00 00 00",
  AD: "+376 000 000",
  AO: "+244 000 000 000",
  AG: "+1 000 000 0000",
  AR: "+54 00 0000 0000",
  AM: "+374 000 00 00 00",
  AU: "+61 0000 000 000",
  AT: "+43 000 000 000",
  AZ: "+994 000 000 00 00",
  BS: "+1 000 000 0000",
  BH: "+973 0000 0000",
  BD: "+880 00000 000000",
  BB: "+1 000 000 0000",
  BY: "+375 00 000 00 00",
  BE: "+32 000 00 00 00",
  BZ: "+501 000 0000",
  BJ: "+229 00 00 00 00",
  BT: "+975 000 0000",
  BO: "+591 000 00000",
  BA: "+387 00 000 000",
  BW: "+267 00 000 000",
  BR: "+55 00 00000 0000",
  BN: "+673 000 000 0000",
  BG: "+359 000 000 000",
  BF: "+226 00 00 00 00",
  BI: "+257 00 00 00 00",
  CV: "+238 000 00 00",
  KH: "+855 000 000 000",
  CM: "+237 000 00 00 00",
  CA: "+1 000 000 0000",
  CF: "+236 00 00 00 00",
  TD: "+235 00 00 00 00",
  CL: "+56 00 0000 0000",
  CN: "+86 000 0000 0000",
  CO: "+57 000 000 0000",
  KM: "+269 000 0000",
  CG: "+242 000 000 000",
  CD: "+243 000 000 000",
  CR: "+506 0000 0000",
  HR: "+385 00 000 0000",
  CU: "+53 000 000 0000",
  CY: "+357 00 000 000",
  CZ: "+420 000 000 000",
  DK: "+45 00 00 00 00",
  DJ: "+253 00 00 00 00",
  DM: "+1 000 000 0000",
  DO: "+1 000 000 0000",
  TL: "+670 000 000 000",
  EC: "+593 00 000 0000",
  EG: "+20 0000 000 000",
  SV: "+503 0000 0000",
  GQ: "+240 00 00 00 00",
  ER: "+291 00 00 00 00",
  EE: "+372 000 000 000",
  SZ: "+268 000 00 00 00",
  ET: "+251 000 00 00 00",
  FJ: "+679 000 0000",
  FI: "+358 000 0000 000",
  FR: "+33 00 00 00 00 00",
  GA: "+241 00 00 00 00",
  GM: "+220 000 0000",
  GE: "+995 000 00 00 00",
  DE: "+49 000 000 0000",
  GH: "+233 000 000 0000",
  GR: "+30 000 0000 0000",
  GD: "+1 000 000 0000",
  GT: "+502 0000 0000",
  GN: "+224 00 00 00 00",
  GW: "+245 00 00 00 00",
  GY: "+592 000 000 0000",
  HT: "+509 0000 0000",
  HN: "+504 000 000 0000",
  HU: "+36 00 000 000",
  IS: "+354 000 0000",
  IN: "+91 00000 00000",
  ID: "+62 000 0000 000",
  IR: "+98 000 000 0000",
  IQ: "+964 00 000 000",
  IE: "+353 000 000 000",
  IL: "+972 00 000 0000",
  IT: "+39 000 000 0000",
  JM: "+1 000 000 0000",
  JP: "+81 00 0000 0000",
  JO: "+962 00 000 0000",
  KZ: "+7 000 000 000",
  KE: "+254 000 000 000",
  KI: "+686 000 0000",
  KW: "+965 0000 0000",
  KG: "+996 000 000 000",
  LA: "+856 00 00 0000",
  LV: "+371 000 000 0000",
  LB: "+961 00 000 000",
  LS: "+266 000 000 000",
  LR: "+231 00 00 00 00",
  LY: "+218 000 000 000",
  LI: "+423 000 000 00",
  LT: "+370 00 00 00 00",
  LU: "+352 00 00 00 00",
  MG: "+261 00 00 00 00",
  MW: "+265 000 00 00",
  MY: "+60 000 000 000",
  MV: "+960 000 0000",
  ML: "+223 00 00 00 00",
  MT: "+356 00 00 00 00",
  MH: "+692 000 0000",
  MR: "+222 00 00 00 00",
  MU: "+230 000 0000",
  MX: "+52 00 0000 0000",
  FM: "+691 000 000 0000",
  MD: "+373 000 000 000",
  MC: "+377 00 00 00",
  MN: "+976 000 0000",
  ME: "+382 00 000 000",
  MA: "+212 000 00 00 00",
  MZ: "+258 00 00 00 00",
  MM: "+95 000 00 00 00",
  NA: "+264 000 0000",
  NR: "+674 000 000",
  NP: "+977 000 000000",
  NL: "+31 00 00 00 00",
  NZ: "+64 00 000 0000",
  NI: "+505 0000 0000",
  NE: "+227 00 00 00 00",
  NG: "+234 000 000 0000",
  KP: "+850 00 00 00",
  MK: "+389 000 000 000",
  NO: "+47 000 00 000",
  OM: "+968 0000 0000",
  PK: "+92 000 000 0000",
  PW: "+680 000 000 0000",
  PA: "+507 000 0000",
  PG: "+675 000 0000",
  PY: "+595 000 000 000",
  PE: "+51 00 000 000",
  PH: "+63 00 000 0000",
  PL: "+48 000 000 000",
  PT: "+351 000 000 000",
  QA: "+974 0000 0000",
  RO: "+40 000 000 000",
  RU: "+7 000 000 0000",
  RW: "+250 000 00 00 00",
  KN: "+1 000 000 0000",
  LC: "+1 000 000 0000",
  VC: "+1 000 000 0000",
  WS: "+685 000 000",
  SM: "+378 000 0000",
  ST: "+239 000 0000",
  SA: "+966 000 000 0000",
  SN: "+221 00 000 00 00",
  RS: "+381 000 000 000",
  SC: "+248 000 0000",
  SL: "+232 00 00 00 00",
  SG: "+65 000 000 0000",
  SK: "+421 00 000 0000",
  SI: "+386 00 000 000",
  SB: "+677 000 0000",
  SO: "+252 000 000 000",
  ZA: "+27 000 000 0000",
  KR: "+82 000 0000 0000",
  SS: "+211 00 00 00 00",
  ES: "+34 000 000 000",
  LK: "+94 000 000 0000",
  SD: "+249 000 0000",
  SR: "+597 000 000 0000",
  SE: "+46 000 000 000",
  CH: "+41 00 000 00 00",
  SY: "+963 00 000 000",
  TW: "+886 000 0000 0000",
  TJ: "+992 00 000 000",
  TZ: "+255 000 000 000",
  TH: "+66 00 000 0000",
  TG: "+228 00 00 00 00",
  TO: "+676 000 000",
  TT: "+1 000 000 0000",
  TN: "+216 00 000 000",
  TR: "+90 000 000 0000",
  TM: "+993 000 000 000",
  TV: "+688 000 000",
  UG: "+256 000 0000 000",
  UA: "+380 000 000 000",
  AE: "+971 000 000 0000",
  GB: "+44 0000 000 000",
  US: "+1 000 000 0000",
  UY: "+598 00 000 0000",
  UZ: "+998 000 000 000",
  VU: "+678 000 0000",
  VA: "+379 00 00 00 00",
  VE: "+58 0000 000 0000",
  VN: "+84 00 0000 0000",
  YE: "+967 00 000 000",
  ZM: "+260 00 000 000",
  ZW: "+263 000 0000",
};

$(document).ready(function () {
  const $countrySelector = $('select[data-country-selector="true"]');
  const $phoneInput = $('input[data-phone-style="true"]');

  $countrySelector.empty();
  $countrySelector.append('<option value=""> </option>');
  $.each(countryCodes, function (index, countryCode) {
    const countryEmoji = countryCodeToEmoji(countryCode);
    $countrySelector.append(
      `<option value="${countryCode}">${countryEmoji}</option>`
    );
  });

  function countryCodeToEmoji(countryCode) {
    return countryCode
      .toUpperCase()
      .replace(/./g, (char) =>
        String.fromCodePoint(char.charCodeAt(0) + 127397)
      );
  }

  $.getJSON("https://ipapi.co/json", function (data) {
    const userCountryCode = data.country;
    if (userCountryCode) {
      $countrySelector.val(userCountryCode.toUpperCase());
      $countrySelector.find('option[value=""]').remove();
      updatePlaceholder(userCountryCode);
    }
  });

  $phoneInput.on("input", function () {
    const selectedCountryCode = $countrySelector.val();
    formatPhoneNumber($(this), selectedCountryCode);
  });

  function formatPhoneNumber(input, countryCode) {
    const phoneNumber = input.val();
    try {
      const phoneNumberInstance = libphonenumber.parsePhoneNumberFromString(
        phoneNumber,
        countryCode
      );
      if (phoneNumberInstance) {
        input.val(phoneNumberInstance.formatInternational());
      }
    } catch (error) {
      console.log("Invalid phone number");
    }
  }

  function reformatNumberForNewCountry(countryCode) {
    const phoneNumber = $phoneInput.val();
    if (!phoneNumber) return;

    try {
      // Parse phone number without the country code
      const parsedPhoneNumber =
        libphonenumber.parsePhoneNumberFromString(phoneNumber);

      if (parsedPhoneNumber) {
        // Change country and format number to the new country's format
        const reformattedNumber = libphonenumber
          .parsePhoneNumberFromString(
            parsedPhoneNumber.nationalNumber,
            countryCode
          )
          .formatInternational();
        $phoneInput.val(reformattedNumber);
      }
    } catch (error) {
      console.log("Invalid phone number when reformatting for new country");
    }
  }

  function updatePlaceholder(countryCode) {
    const placeholder = exampleNumbers[countryCode] || "0000000000";
    $phoneInput.attr("placeholder", placeholder);
  }

  $countrySelector.on("mousedown", function () {
    $.each(countryCodes, function (index, countryCode) {
      const countryEmoji = countryCodeToEmoji(countryCode);
      const countryName = countryNames[countryCode];
      $countrySelector
        .find(`option[value="${countryCode}"]`)
        .text(`${countryEmoji} ${countryName}`);
    });
  });

  $countrySelector.on("blur change", function () {
    const selectedCountryCode = $countrySelector.val();
    if (selectedCountryCode) {
      updatePlaceholder(selectedCountryCode);
      reformatNumberForNewCountry(selectedCountryCode); // Reformat when country changes
    }

    setTimeout(function () {
      $.each(countryCodes, function (index, countryCode) {
        const countryEmoji = countryCodeToEmoji(countryCode);
        $countrySelector
          .find(`option[value="${countryCode}"]`)
          .text(countryEmoji);
      });
    }, 100);
  });

  $countrySelector.on("change", function () {
    const selectedCountryCode = $countrySelector.val();
    formatPhoneNumber($phoneInput, selectedCountryCode);
    updatePlaceholder(selectedCountryCode);
    reformatNumberForNewCountry(selectedCountryCode); // Reformat when the country is changed
  });
});
